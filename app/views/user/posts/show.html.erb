<% if flash[:post_success] %>
  <div class="alert alert-success mt-4 text-center w-25 mx-auto">
    <%= flash[:post_success] %>
  </div>
<% end %>
<% if flash[:post_edit_success] %>
  <div class="alert alert-success mt-4 text-center w-25 mx-auto">
    <%= flash[:post_edit_success] %>
  </div>
<% end %>

<div class="shadow-lg card mb-5 mt-5" style="width: 60%; margin: auto; border-radius: 25px; overflow: hidden;">
  <div class="card-header d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center">
      <%= link_to user_path(@post.user) do %>
        <%= image_tag @post.user.get_profile_image(50, 50), class: "rounded-circle" %>
        <span style="font-weight: bold; font-size: 20px; margin-left: 10px; color: black;"><%= @post.user.name %>
      <% end %>
    </div>
    <% if current_user == @post.user %>
      <div class="ml-auto d-flex">
        <%= link_to edit_post_path, class: "text-dark text-right mr-2" do %>
          <button class="btn btn-outline-dark">投稿を編集する <i class="fa-solid fa-pen"></i></button>
        <% end %>
        <%= link_to '削除 <i class="fa-solid fa-trash-can"></i>'.html_safe, post_path, method: :delete, data: { confirm: '本当に消しますか？' }, class: "btn btn-outline-danger"%>
      </div>
    <% end %>
  </div>

  <div class="card-body">
    <% if @post.post_image.attached? %>
      <%= image_tag @post.post_image, class: "card-img-top", style: "width: 100%;" %>
    <% else %>
      <%= image_tag 'no_image2.png', class: "card-img-top", style: "width: 100%;" %>
    <% end %>
    <h5 class="card-title" style="font-weight: bold; font-size: 30px; margin-top: 20px;" ><%= @post.title %></h5>
    <i class="fa-regular fa-clock ml-2"></i> 投稿日：<%= @post.created_at.strftime("%Y年%m月%d日") %>
    <span style="margin: 0 6px;">&nbsp;</span>
    <i class="fa-solid fa-rotate-right"></i> 最終変更日：<%= @post.updated_at.strftime("%Y年%m月%d日") %>
    <p class="card-text mt-3" style="font-size: 20px"><%= @post.body %></p>
    <div class="d-flex justify-content-left ml-2">
      <div id="like_btn_<%= @post.id %>">
        <%= render 'user/likes/btn', post: @post %>
      </div>
      <div>
        <span style="color: #343a40; margin-left: 14px;"><i class="fa-regular fa-comment-dots fa-2x"></i>
        <span style="font-size: 24px;"><%= @post.post_comments.count %></span>
      </div>
    </div>
    <div class="container">
      <div class="row justify-content-left">
        <%= form_with model: [@post, @post_comment] do |f| %>
        <div class="d-flex align-items-center ml-2 mt-4 mb-3" style="width: 100%;">
          <%= f.text_area :body, cols: 110, placeholder: "コメントを入力", class: "form-control" %>
          <%= f.submit "送信", class: "btn btn-secondary ml-3"%>
        </div>
        <% end %>
      </div>
    </div>

    <table>
      <% @post.post_comments.each do |post_comment| %>
      <tr>
        <td>
          <%= link_to user_path(post_comment.user) do %>
            <%= image_tag post_comment.user.get_profile_image(30, 30), class: "rounded-circle ml-2" %>
          <% end %>
        </td>
        <td class="mb-2">
          <%= post_comment.body %>
          <% if post_comment.user == current_user %>
            <%= link_to "削除", post_post_comment_path(@post, post_comment), method: :delete, data: { confirm: '本当に消しますか？' }, class: "btn btn-sm btn-outline-danger float-end ml-3" %>
          <% end %>
        </td>
      </tr>
      <% end %>
    </table>
  </div>
</div>








